<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Set Password</title>
  <link rel="stylesheet" href="/assets/styles.css" />
  
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Bright Waves</h1>
        <div class="sub">Set your password</div>
      </div>
    </div>
    <div class="pill"><span class="small">First login password setup</span></div>
  </div>
  <div class="container">
    <div class="card" style="max-width:640px;margin:0 auto">
      <h2>Create a new password</h2>
      <div class="muted">You must change the temporary password before continuing.</div>
      <div class="hr"></div>
      <input id="p1" class="input" type="password" placeholder="New password" autocomplete="new-password"/>
      <div style="height:10px"></div>
      <input id="p2" class="input" type="password" placeholder="Confirm new password" autocomplete="new-password"/>
      <div class="small" style="margin-top:10px">
        Policy: minimum 10 characters, with uppercase, lowercase, number, and symbol.
      </div>
      <div style="height:12px"></div>
      <button class="btn" id="saveBtn" style="width:100%">Set Password</button>
      <div id="err" class="small" style="margin-top:10px;color:#b91c1c"></div>
    </div>
  </div>
<script>
(async ()=>{
  await requireAuth();
  const btn = document.getElementById('saveBtn');
  btn.onclick = async ()=>{
    setText('err','');
    const p1 = document.getElementById('p1').value;
    const p2 = document.getElementById('p2').value;
    if(p1 !== p2){ setText('err','Passwords do not match.'); return; }
    btn.disabled = true;
    try{
      await API.post('/api/set-password',{password:p1});
      location.href = qs('next')||'/dashboard';
    }catch(e){
      setText('err', e.message || String(e));
    }finally{
      btn.disabled = false;
    }
  };
})();
</script>

<script src="/assets/client.js"></script>
</body>
</html>
